<head>
    <!--style-->
</head>

<body>
    <div id="container">
        <input type="number" placeholder="Number of Players" class="setting" id="number-players">
        <input type="number" placeholder="Starting Chips" class="setting" id="start-chips">
        <button class="reset">Reset Game</button>
        <h2 id="pot">Pot: 0</h2>
        <button class="rotate-dealer">Rotate Dealer</button>
        <table id="control-table"></table>
    </div>

    <script>
        let pot, chips, bets, maxBet;

        let setup = () => {
            const NUM_PLAYERS = document.getElementById("number-players").valueAsNumber;
            const START_CHIPS = document.getElementById("start-chips").valueAsNumber;
            
            //empty table & vars
            pot = 0;
            chips = [];
            bets = [];
            maxBet = 0;
            document.getElementById("control-table").innerHTML = "";

            //fills table
            for (let i = 0; i < NUM_PLAYERS; i++) {
                let row = document.getElementById("control-table").insertRow();
                const control_layout = ["<button class=\"plus\">+</button>", "<button class=\"minus\">-</button>", "<label>" + 
                                        START_CHIPS + "</label>", "<input type=\"text\" placeholder=\"Name\">", 
                                        "<button class=\"call\">Call</button>", "<button class=\"award\">Award Pot</button>"];

                bets.push(0);
                chips.push(START_CHIPS);

                for (let j = 0; j < 6; j++) {
                    let cell = row.insertCell();
                    cell.innerHTML = control_layout[j];
                }
            }

            let buttons = document.querySelectorAll("button");
            buttons.forEach((button) => {
                button.addEventListener("touchstart", handlePokerInteraction);
                button.addEventListener("click", handlePokerInteraction);
            });
        }

        //handles control table inputs THROWS ERRORS EVERY CLICK
        let handlePokerInteraction = (e) => {

            let dPot = 0;
            let targetClass = e.target.getAttribute("class");
            let targetRow = e.target.parentElement.parentElement.rowIndex;

            switch (targetClass) {
                case "plus":
                case "minus":
                    if (targetClass == "plus") dPot++; else dPot--;
                    pot += dPot;
                    bets[targetRow] += dPot;
                    chips[targetRow] -= dPot;
                    maxBet = Math.max.apply(null, bets);
                    //conditional call button disabling
                    break;

                case "call":
                    if (bets[targetRow] < maxBet) {
                        let dBets = maxBet - bets[targetRow];
                        pot += dBets;
                        bets[targetRow] += dBets;
                        chips[targetRow] -= dBets;
                    }
                    break;

                case "award":
                    chips[targetRow] += pot;
                    pot = 0;
                    bets.fill(0);
                    maxBet = 0;
                    break;
                
                case "reset":
                    setup();
                    break;

                case "rotate-dealer":
                    let table = document.getElementById("control-table");
                    let buffer = table.rows[0];
                    table.deleteRow(0);
                    table.appendChild(buffer);
                    chips.push(chips[0]);
                    chips.shift();
                    bets.fill(0);
                    maxBet = 0;
                    break;
            }
            console.log(bets);
            console.log(targetRow);

            document.getElementById("pot").innerText = "Pot: " + pot;
            document.getElementById("control-table").rows[targetRow].getElementsByTagName("label")[0].innerText = chips[targetRow];
        }

        //sets up table when value is changed
        let settings = document.querySelectorAll(".setting");
        settings.forEach((setting) => {
            setting.addEventListener("input", setup);
        });
    </script>
</body>